

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. Spherical harmonics &#8212; Tectonophysics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'files/L0_Harmonic_Scalar';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Spherical harmonic vectors" href="L0_Harmonic_Vectors.html" />
    <link rel="prev" title="3. The Laplace transform" href="L1_Laplace.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/gc_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/gc_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="A0_Setup.html">1. Working with JupyterLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="A1_Tutorial.html">2. Tutorial on Python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="L1_Laplace.html">3. The Laplace transform</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. Spherical harmonics</a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_Harmonic_Vectors.html">5. Spherical harmonic vectors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="T1_Potentials.html">6. Gravitatational potentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2_Kinematics.html">7. Kinematics and reference systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2_Reference.html">8. The Earth reference system</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2_Equations.html">9. Momentum and Poisson equations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="L3_Self.html">10. Perturbation theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="L4_Analytical.html">11. Analytical solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="L5_Euler.html">12. Rotational dynamics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Codes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="C1_Codes.html">13. Homogeneous incompressible Earth model</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Z0_Dirac.html">16. Dirac delta function</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/files/L0_Harmonic_Scalar.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spherical harmonics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legendre-polynomials">4.1. Legendre polynomials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-the-legendre-polynomials">4.1.1. Implementation of the Legendre polynomials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-caps">4.1.2. Spherical caps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-realistic-shape-for-an-ice-shield">4.1.3. A more realistic shape for an ice shield</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-spherical-harmonics">4.2. Real spherical harmonics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-expansion">4.2.1. Spherical harmonic expansion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-addition-theorem">4.2.2. Spherical harmonic addition theorem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#centrifugal-potential">4.2.3. Centrifugal potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-associated-legendre-polynomials">4.2.4. Plotting the associated Legendre polynomials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-spherical-harmonics">4.2.5. Plotting the spherical harmonics</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spherical-harmonics">
<h1><span class="section-number">4. </span>Spherical harmonics<a class="headerlink" href="#spherical-harmonics" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="sections">
<p class="topic-title">Sections</p>
<ul class="simple">
<li><p><a class="reference internal" href="#legendre-polynomials" id="id1">Legendre polynomials</a></p>
<ul>
<li><p><a class="reference internal" href="#implementation-of-the-legendre-polynomials" id="id2">Implementation of the Legendre polynomials</a></p></li>
<li><p><a class="reference internal" href="#spherical-caps" id="id3">Spherical caps</a></p></li>
<li><p><a class="reference internal" href="#a-more-realistic-shape-for-an-ice-shield" id="id4">A more realistic shape for an ice shield</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#real-spherical-harmonics" id="id5">Real spherical harmonics</a></p>
<ul>
<li><p><a class="reference internal" href="#spherical-harmonic-expansion" id="id6">Spherical harmonic expansion</a></p></li>
<li><p><a class="reference internal" href="#spherical-harmonic-addition-theorem" id="id7">Spherical harmonic addition theorem</a></p></li>
<li><p><a class="reference internal" href="#centrifugal-potential" id="id8">Centrifugal potential</a></p></li>
<li><p><a class="reference internal" href="#plotting-the-associated-legendre-polynomials" id="id9">Plotting the associated Legendre polynomials</a></p></li>
<li><p><a class="reference internal" href="#plotting-the-spherical-harmonics" id="id10">Plotting the spherical harmonics</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="full-width docutils">
<p>In this lecture we will introduce the Legendre polynomial and we will use them for representing axially symmetric functions defined over the sphere. Then, we will consider the spherical harmonics for representing general functions on the unit sphere.</p>
</div>
<p><span class="math notranslate nohighlight">\(\newcommand{\md}{\mathrm{d}\hspace{0cm}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\mdd}{\mathrm{d}\hspace{0cm}^2}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\grad}{\boldsymbol{\nabla}\hspace{-0.01cm}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\stress}{\boldsymbol{\sigma}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\bn}[1]{\hat{\mathbf{#1}}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\bb}[1]{\mathbf{#1}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\sn}[1]{\hat{\boldsymbol{#1}}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\sb}[1]{\boldsymbol{#1}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\zero}{\mathbf{0}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\one}{\mathbf{1}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\loc}{\Delta\hspace{0cm}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\mat}{\delta\hspace{0cm}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\det}{\mathrm{\det}\hspace{0cm}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\cm}[1]{\bar{\bb{#1}}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\lmsum}{\sum_{n=0}^\infty\sum_{m=-n}^n}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\kqsum}{\sum_{k=0}^\infty\sum_{q=-k}^k}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dif}[1]{#1\hspace{0cm}\prime}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dermat}[1]{\frac{\mathrm{D}\hspace{0.02cm}#1}{\mathrm{D}\hspace{0.02cm} t}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dercla}[1]{\frac{\mathrm{d}\hspace{0.02cm}#1}{\mathrm{d}\hspace{0.02cm} t}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\derpar}[1]{\frac{\partial\hspace{0.02cm}#1}{\partial\hspace{0.02cm} t}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\rpar}[2]{\frac{\partial\hspace{0.02cm}#1}{\partial\hspace{0.02cm} r_{#2}}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\xpar}[2]{\frac{\partial\hspace{0.02cm}#1}{\partial\hspace{0.02cm} x_{#2}}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\ddermat}[1]{\frac{\mathrm{D}^2\hspace{0.02cm}#1}{\mathrm{D}\hspace{0.02cm} t^2}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\ddercla}[1]{\frac{\mathrm{d}^2\hspace{0.02cm}#1}{\mathrm{d}\hspace{0.02cm} t^2}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dderpar}[1]{\frac{\partial^2\hspace{0.02cm}#1}{\partial\hspace{0.02cm} t^2}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\drpar}[2]{\frac{\partial^2\hspace{0.02cm}#1}{\partial\hspace{0.02cm} r_{#2}^2}}\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dxpar}[2]{\frac{\partial^2\hspace{0.02cm}#1}{\partial\hspace{0.02cm} x_{#2}^2}}\)</span></p>
<section id="legendre-polynomials">
<span id="sec-legendre"></span><h2><a class="toc-backref" href="#id1"><span class="section-number">4.1. </span>Legendre polynomials</a><a class="headerlink" href="#legendre-polynomials" title="Permalink to this headline">#</a></h2>
<div class="full-width docutils">
<p>The Legendre polynomials <span class="math notranslate nohighlight">\(P_n\)</span> are real-valued function <span class="math notranslate nohighlight">\(P_n:[-1,1]\rightarrow \mathbb{R}\)</span> defined on the interval <span class="math notranslate nohighlight">\([-1,1]\subset\mathbb{R}\)</span> as follows</p>
<div class="math notranslate nohighlight" id="equation-p-1">
<span class="eqno">(4.1)<a class="headerlink" href="#equation-p-1" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp; P_n(z) = \frac{(-1)^n}{2^n\,n!}\,\frac{\md^n}{\md z^n} (1-z^2)^n
\end{align}
\]</div>
<p>and are solutions of the following differential equation</p>
<div class="math notranslate nohighlight" id="equation-p-2">
<span class="eqno">(4.2)<a class="headerlink" href="#equation-p-2" title="Permalink to this equation">#</a></span>\[\begin{align}
&amp;
( 1 − z^2 )\,\ddot{P}_n( z ) − 2\, z \,\dot{P}_n ( z ) + n\, ( n + 1 ) \,P_n ( z ) = 0
\end{align}
\]</div>
<p>They are orthogonal to each other in the sense that they satisfy the following identity</p>
<div class="math notranslate nohighlight" id="equation-p-3">
<span class="eqno">(4.3)<a class="headerlink" href="#equation-p-3" title="Permalink to this equation">#</a></span>\[\begin{align}
&amp;
\int_{-1}^1 P_n(z)\,P_p(z)\,\md z=\frac{2}{2\,n+1}\,\delta_{n,p} 
\end{align}
\]</div>
<p>Here <span class="math notranslate nohighlight">\(n=0,\cdots,\infty\)</span> is the degree of the Legendre polynomial that is a non negative integer.</p>
<p>The Legendre polynomials can be used for representing any piecewise continuous function <span class="math notranslate nohighlight">\(f\)</span> with finitely many discontinuities in the interval <span class="math notranslate nohighlight">\([−1, 1]\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-4">
<span class="eqno">(4.4)<a class="headerlink" href="#equation-p-4" title="Permalink to this equation">#</a></span>\[\begin{align}
&amp;
f(z) = \sum_n f_n\,P_n(z)
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(f_n\)</span> are the Legendre coefficients and</p>
<div class="math notranslate nohighlight" id="equation-p-5">
<span class="eqno">(4.5)<a class="headerlink" href="#equation-p-5" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;\int_{-1}^1 \left| f(z)\right|^2\,\md z &lt; \infty
\end{align}
\]</div>
<p>Thanks to the orthogonality of the Legendre polynomials, the Legendre coefficients can be calculated as follows</p>
<div class="math notranslate nohighlight" id="equation-p-6">
<span class="eqno">(4.6)<a class="headerlink" href="#equation-p-6" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;f_n = \frac{2\,n+1}{2}\,\int_{-1}^1 f(z)\,P_n(z)\,\md z 
\end{align}
\]</div>
</div>
<section id="implementation-of-the-legendre-polynomials">
<h3><a class="toc-backref" href="#id2"><span class="section-number">4.1.1. </span>Implementation of the Legendre polynomials</a><a class="headerlink" href="#implementation-of-the-legendre-polynomials" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Starting from eq. <a class="reference internal" href="#equation-p-1">(4.1)</a>, it can be shown that the Legendre polynomials satisfy the following recurrence relation</p>
<div class="math notranslate nohighlight" id="equation-p-7">
<span class="eqno">(4.7)<a class="headerlink" href="#equation-p-7" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;(n+1)\,P_{n+1}(z) = (2\,n+1)\,z\,P_n(z) - n\,P_{n-1}(z)
\end{align}
\]</div>
<p>which can be used for calculating the Legendre polynomial of any degree <span class="math notranslate nohighlight">\(n\)</span> starting from the Legendre polynomials of degrees <span class="math notranslate nohighlight">\(n=0\)</span> and <span class="math notranslate nohighlight">\(1\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-8">
<span class="eqno">(4.8)<a class="headerlink" href="#equation-p-8" title="Permalink to this equation">#</a></span>\[
\begin{align}
P_0(z) &amp;= 1
\qquad P_1(z) = z\end{align}
\]</div>
<p>For instance, the Legendre polynomial of degree <span class="math notranslate nohighlight">\(n=2\)</span> reads</p>
<div class="math notranslate nohighlight" id="equation-p-9">
<span class="eqno">(4.9)<a class="headerlink" href="#equation-p-9" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;P_2(z) = \frac{3\,z^2-1}{2}
\end{align}
\]</div>
<p>We note that</p>
<div class="math notranslate nohighlight" id="equation-p-10">
<span class="eqno">(4.10)<a class="headerlink" href="#equation-p-10" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;P_n(1) = 1 \qquad P_n(-1) = (-1)^n
\end{align}
\]</div>
<p>The first derivative of the Legendre polynomials, instead, can be computed using the following relation</p>
<div class="math notranslate nohighlight" id="equation-p-11">
<span class="eqno">(4.11)<a class="headerlink" href="#equation-p-11" title="Permalink to this equation">#</a></span>\[
\begin{align}
&amp;(1-z^2)\,\dot{P}_n(z) = (n+1)\,\big(z\,P_n(z)-P_{n+1}(z) \big)
\end{align}
\]</div>
<p>Let us now calculate the Legendre polynomial at given <span class="math notranslate nohighlight">\(z\in[-1,1]\)</span> up to the maximum degree <span class="math notranslate nohighlight">\(N=100\)</span> making use of the recurrence relation and of the two starting values,  eqs. <a class="reference internal" href="#equation-p-7">(4.7)</a> and <a class="reference internal" href="#equation-p-8">(4.8)</a>, in python</p>
</div>
<div class="cell tag_hide-input tag_full-width docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> widget
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">eva_Pn</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>          
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    \n\n Return the Legendre polynomials at &quot;x&quot; up to maximum degree &quot;N&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Pn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Pn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pn</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_full-width docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>          <span class="c1"># maximum degree </span>

<span class="c1"># Figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]:</span>
    <span class="n">Pn</span> <span class="o">=</span> <span class="n">eva_Pn</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>    <span class="c1"># Legendre polynomial at &quot;z&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Pn</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;z = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Degree n&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Legendre polynomial  $P_n(z)$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/01a7737d5adfee82d461995dd9f40b261cc682d122f91dd1a6b6986ec88ff00c.png" src="../_images/01a7737d5adfee82d461995dd9f40b261cc682d122f91dd1a6b6986ec88ff00c.png" />
</div>
</div>
<div class="full-width docutils">
<p>Also, let us plot the Legendre polynomials in the interval <span class="math notranslate nohighlight">\([-1,1]\)</span> for a few degrees by considering <span class="math notranslate nohighlight">\(z=\cos\vartheta\)</span></p>
</div>
<div class="cell tag_hide-input tag_full-width docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eva_Pns</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    \n\n Return the Legendre polynomial at different &quot;zs&quot; and up to the maximum degree &quot;N&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Pns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">Pns</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Pns</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zs</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Pns</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">zs</span><span class="o">*</span><span class="n">Pns</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">Pns</span><span class="p">[:,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pns</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_full-width docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>    <span class="c1"># colatitudes</span>
<span class="n">dtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>                      <span class="c1"># from deg to radians</span>
<span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">colats</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>              <span class="c1"># cosine of the colatitudes</span>
<span class="n">Pns</span> <span class="o">=</span> <span class="n">eva_Pns</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>                  <span class="c1"># Legendre polynomials  </span>

<span class="c1"># Figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">70</span><span class="p">]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">colats</span><span class="p">,</span><span class="n">Pns</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;n = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Colatitude $\vartheta$  [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Legendre polynomial  $P_n(\cos</span><span class="se">\v</span><span class="s2">artheta)$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/6f8ee144b0ce25285a28bbdd0f21ff051b011bb59cb885159a123d25a20d41f3.png" src="../_images/6f8ee144b0ce25285a28bbdd0f21ff051b011bb59cb885159a123d25a20d41f3.png" />
</div>
</div>
<div class="full-width dropdown admonition">
<p class="admonition-title">Integrals</p>
<p>Let us recast eq. <a class="reference internal" href="#equation-p-2">(4.2)</a> in the following form</p>
<div class="math notranslate nohighlight" id="equation-p-12">
<span class="eqno">(4.12)<a class="headerlink" href="#equation-p-12" title="Permalink to this equation">#</a></span>\[
\frac{\md}{\md z}\big((1-z^2)\,\dot{P}_n(z)\big) = -n\,(n+1)\,P_n(z)
\]</div>
<p>and integrate it over the interval <span class="math notranslate nohighlight">\([a,1]\)</span> for obtaining the following identity</p>
<div class="math notranslate nohighlight" id="equation-p-13">
<span class="eqno">(4.13)<a class="headerlink" href="#equation-p-13" title="Permalink to this equation">#</a></span>\[
n\,(n+1)\,\int_{a}^1 P_n(z) = -(1-z^2)\,\dot{P}_n(z))\Big|_{a}^{1} = (n+1)\,\big(a\,P_n(a)-P_{n+1}(a) \big)
\]</div>
<p>For any degree <span class="math notranslate nohighlight">\(n&gt;0\)</span>, we thus can write</p>
<div class="math notranslate nohighlight" id="equation-p-14">
<span class="eqno">(4.14)<a class="headerlink" href="#equation-p-14" title="Permalink to this equation">#</a></span>\[
\int_{a}^1 P_n(z) = \frac{a\,P_n(a)-P_{n+1}(a)}{n} \qquad \forall\,n&gt;0
\]</div>
<p>for all degree <span class="math notranslate nohighlight">\(n&gt;0\)</span>. For the degree <span class="math notranslate nohighlight">\(n=0\)</span>, instead, we simply have</p>
<div class="math notranslate nohighlight" id="equation-p-15">
<span class="eqno">(4.15)<a class="headerlink" href="#equation-p-15" title="Permalink to this equation">#</a></span>\[
\int_{a}^1 P_0(z)\,\md z = \int_a^1\,\md z = 1-a
\]</div>
</div>
<div class="cell tag_remove_input tag_full-width docutils container">
</div>
<div class="full-width docutils">
<figure class="align-default" id="fig-cap-shield">
<img alt="../_images/766839143b435b2f5d7fa47143d94b889f6e8fb4252fe55a08ecdf7779fc9079.png" src="../_images/766839143b435b2f5d7fa47143d94b889f6e8fb4252fe55a08ecdf7779fc9079.png" />
<figcaption>
<p><span class="caption-number">Fig. 4.1 </span><span class="caption-text">Spherical cap and shield functions (left and right panels) with angular arc of <span class="math notranslate nohighlight">\(\alpha=30^\circ\)</span> drawn on a meridian. Their centres coincide with the north pole.</span><a class="headerlink" href="#fig-cap-shield" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</section>
<section id="spherical-caps">
<h3><a class="toc-backref" href="#id3"><span class="section-number">4.1.2. </span>Spherical caps</a><a class="headerlink" href="#spherical-caps" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Let us consider, as shown in <a class="reference internal" href="#fig-cap-shield"><span class="std std-numref">Figure 4.1</span></a>, the spherical cap function <span class="math notranslate nohighlight">\(f\)</span> defined over the sphere in such a way that it yields <span class="math notranslate nohighlight">\(f=1\)</span> within a circular cap centred at colatitude  <span class="math notranslate nohighlight">\(\theta_0\)</span> and longitude <span class="math notranslate nohighlight">\(\phi_0\)</span> of angular arc <span class="math notranslate nohighlight">\(\alpha\)</span>, and <span class="math notranslate nohighlight">\(f=0\)</span> outside. In this respect, it can be defined as follows</p>
<div class="math notranslate nohighlight" id="equation-p-16">
<span class="eqno">(4.16)<a class="headerlink" href="#equation-p-16" title="Permalink to this equation">#</a></span>\[
f(\theta,\phi) = H(\alpha-\gamma) = H(\cos\gamma-\cos\alpha) = H(z-a)
\]</div>
<p>with <span class="math notranslate nohighlight">\(z=\cos\gamma\)</span> and <span class="math notranslate nohighlight">\(a=\cos\alpha\)</span>, <span class="math notranslate nohighlight">\(H\)</span> being the Heaviside function and <span class="math notranslate nohighlight">\(\gamma\in[0,\pi]\)</span> the angle between <span class="math notranslate nohighlight">\((\theta,\phi)\)</span> and <span class="math notranslate nohighlight">\((\theta_0,\phi_0)\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-17">
<span class="eqno">(4.17)<a class="headerlink" href="#equation-p-17" title="Permalink to this equation">#</a></span>\[
z = \cos\gamma = \bn{r}(\vatheta,\varphi)\cdot\bn{\vartheta_0,\varphi_0) = \cos\theta\,\cos\theta_0 + \sin\theta_0\,\sin\theta_0\,\cos(\phi-\phi_0)
\]</div>
<p>By considering that <span class="math notranslate nohighlight">\(z=\cos\gamma\in[-1,1]\)</span>, we can represent the cap function using the Legendre polynomials</p>
<div class="math notranslate nohighlight" id="equation-p-18">
<span class="eqno">(4.18)<a class="headerlink" href="#equation-p-18" title="Permalink to this equation">#</a></span>\[
f(\theta,\phi) = H(z-a) = \sum_{n=0}^\infty f_n\,P_n(z)
\]</div>
<p>where, according to eq. <a class="reference internal" href="#equation-p-6">(4.6)</a>, the Legendre coefficients are given by the following intergal</p>
<div class="math notranslate nohighlight" id="equation-p-19">
<span class="eqno">(4.19)<a class="headerlink" href="#equation-p-19" title="Permalink to this equation">#</a></span>\[
f_n = \frac{2\,n+1}{2}\,\int_{-1}^1 f(z)\,P_n(z)\,\md z = \frac{2\,n+1}{2}\int_{\cos\alpha}^1 P_n(z)\,\md z
\]</div>
<p>In view of eqs. <a class="reference internal" href="#equation-p-14">(4.14)</a> and  <a class="reference internal" href="#equation-p-15">(4.15)</a>, we obatin</p>
<div class="math notranslate nohighlight" id="equation-p-20">
<span class="eqno">(4.20)<a class="headerlink" href="#equation-p-20" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{align}
f_n = \begin{cases}
\frac{1-a}{2} &amp; n=0 \\
\left(1+\frac{1}{2\,n}\right)\,\big(a\,P_n(a)-P_{n+1}(a)\big) &amp; n\geq 1
\end{cases}
\end{align}
\end{split}\]</div>
<p>Let us now set the angular arc <span class="math notranslate nohighlight">\(\alpha=30^\circ\)</span> and calculate the Legendre coefficients of the spherical cap function according to eq. <a class="reference internal" href="#equation-p-20">(4.20)</a> up to the maximum harmonic degree <span class="math notranslate nohighlight">\(N=1000\)</span>. In this perspective, we shall calculate the Legendre polynomial up to the degree <span class="math notranslate nohighlight">\(n=N+1\)</span>.</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">30</span>                 <span class="c1"># angular arc</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>      <span class="c1"># its cosine</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>                   <span class="c1"># maximum degree</span>
<span class="n">Pn</span> <span class="o">=</span> <span class="n">eva_Pn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># Legendre polynomial at &quot;a&quot; up to maximum degree &quot;N+1&quot;</span>

<span class="n">fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>        <span class="c1"># Legendre coefficients</span>
<span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>           
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">fn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    
<span class="c1"># Figure</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.35</span><span class="p">,</span><span class="mf">0.35</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Legendre coefficients  $f_n$&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Degree  $n$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c2deaaec2b0bbbe9a80141093b7bf7cf21ea9f6fdfbf247af7df3ad1c8b062b0.png" src="../_images/c2deaaec2b0bbbe9a80141093b7bf7cf21ea9f6fdfbf247af7df3ad1c8b062b0.png" />
</div>
</div>
<div class="full-width docutils">
<p>Let us now calculate the spherical cap function and compare it with its representation in Legendre polynomial truncated up the maximum harmonic degree <span class="math notranslate nohighlight">\(N=100\)</span> and <span class="math notranslate nohighlight">\(1000\)</span></p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">18001</span><span class="p">)</span>    <span class="c1"># colatitudes</span>
<span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>               <span class="c1"># cosine of the colatitudes</span>

<span class="n">function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">gamma</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>     <span class="c1"># cap function</span>
<span class="n">function</span><span class="p">[</span><span class="n">gammas</span><span class="o">&lt;</span><span class="n">alpha</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>                             <span class="c1"># maximum degree</span>
<span class="n">Pns</span> <span class="o">=</span> <span class="n">eva_Pns</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>                  <span class="c1"># Legendre polynomial at &quot;zs&quot; up to &quot;N&quot;</span>

<span class="n">truncated_function</span> <span class="o">=</span> <span class="n">Pns</span> <span class="o">@</span> <span class="n">fn</span>        
<span class="n">truncated_function_100</span> <span class="o">=</span> <span class="n">Pns</span><span class="p">[:,:</span><span class="mi">100</span><span class="p">]</span> <span class="o">@</span> <span class="n">fn</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">gammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">18001</span><span class="p">)</span>    <span class="c1"># colatitudes</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gamma</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>               <span class="c1"># cosine of the colatitudes</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">gamma</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>     <span class="c1"># cap function</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">function</span><span class="p">[</span><span class="n">gammas</span><span class="o">&lt;</span><span class="n">alpha</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="ne">NameError</span>: name &#39;gamma&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_full-width docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span><span class="n">truncated_function</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;truncated N=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span><span class="n">truncated_function_100</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;truncated N=100&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Spherical cap function&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Colatitues $\gamma$ [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/fa9decf27d7aa0fce7ad1b2b38d79604508084c12dbae7ab65b45476852ac761.png" src="../_images/fa9decf27d7aa0fce7ad1b2b38d79604508084c12dbae7ab65b45476852ac761.png" />
</div>
</div>
</section>
<section id="a-more-realistic-shape-for-an-ice-shield">
<span id="sec-shield"></span><h3><a class="toc-backref" href="#id4"><span class="section-number">4.1.3. </span>A more realistic shape for an ice shield</a><a class="headerlink" href="#a-more-realistic-shape-for-an-ice-shield" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Let us consider, as shown in fig. 2, the spherical shield function <span class="math notranslate nohighlight">\(h\)</span> defined as</p>
<div class="math notranslate nohighlight" id="equation-p-21">
<span class="eqno">(4.21)<a class="headerlink" href="#equation-p-21" title="Permalink to this equation">#</a></span>\[
h(\theta,\phi) = \frac{\cos\gamma-\cos\alpha}{1-\cos\alpha}\,H(\cos\gamma-\cos\alpha) = \frac{z-a}{1-a}\,H(z-a)
\]</div>
<p>with <span class="math notranslate nohighlight">\(z=\cos\gamma\)</span> and <span class="math notranslate nohighlight">\(a=\cos\alpha\)</span>. Its Legendre expansion reads</p>
<div class="math notranslate nohighlight" id="equation-p-21a">
<span class="eqno">(4.22)<a class="headerlink" href="#equation-p-21a" title="Permalink to this equation">#</a></span>\[
h(\theta,\phi) = \sum_{n=0}^\infty h_n\,P_n(\cos\gamma)
\]</div>
<p>with the Legendre coefficients <span class="math notranslate nohighlight">\(h_n\)</span> given by</p>
<div class="math notranslate nohighlight" id="equation-p-22">
<span class="eqno">(4.23)<a class="headerlink" href="#equation-p-22" title="Permalink to this equation">#</a></span>\[
h_n = \frac{2\,n+1}{2}\int_a^1 \frac{z-a}{1-a}\,P_n(z)\,\md z = \frac{2\,n+1}{2\,(1-a)}\,\left(\int_a^1 z\,P_n(z)\,\md z - a\,\int_a^1 P_n(z)\,\md z\right)
\]</div>
<p>The second integral in the right-hand side has been already discussed. As it concerns the first one, instead, starting from the following identity</p>
<div class="math notranslate nohighlight" id="equation-p-23">
<span class="eqno">(4.24)<a class="headerlink" href="#equation-p-23" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{align}
\frac{\md (z^2\,P_n(z))}{\md z} - \dot{P}_n(z) &amp;= 2\,z\,P_n(z)+x^2\,\dot{P}_n(z) - \dot{P}_n (z)=2\,z\,P_n(z)-(1-z^2)\,\dot{P}_n(z)  
\\
&amp;=  - (n-1)\,z\,P_n(z) + (n+1)\,P_{n+1}(z) 
\end{align}
\end{split}\]</div>
<p>and making use of the properties of the Legendre polynomials, it can be shown that</p>
<div class="math notranslate nohighlight" id="equation-p-24">
<span class="eqno">(4.25)<a class="headerlink" href="#equation-p-24" title="Permalink to this equation">#</a></span>\[
\begin{align}
\int_a^1 z\,P_n\,\md z
&amp;=   \frac{1}{n-1}\,\left[ \left(a^2-\frac{1}{n+2}\right)\,P_n(a) -  \frac{n+1}{n+2}\,a\,P_{n+1}(a)\,\right] \qquad \forall\,n&gt;1
\end{align}
\]</div>
<p>For the degrees <span class="math notranslate nohighlight">\(n=0\)</span> and <span class="math notranslate nohighlight">\(1\)</span>, instead, we simply have</p>
<div class="math notranslate nohighlight" id="equation-p-25">
<span class="eqno">(4.26)<a class="headerlink" href="#equation-p-25" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{align}
&amp;\int_a^1 z\,P_0(z)\,\md z =\int_a\,z\,\md z = \frac{1-a^2}{2}
\\
&amp;\int_a^1 z\,P_1(z)\,\md z =\int_a\,z^2\,\md z = \frac{1-a^3}{3}
\end{align}
\end{split}\]</div>
<p>The spherical harmonic coefficients of the spherical shield function thus read</p>
<div class="math notranslate nohighlight" id="equation-p-26">
<span class="eqno">(4.27)<a class="headerlink" href="#equation-p-26" title="Permalink to this equation">#</a></span>\[\begin{split}
\begin{align}
h_n &amp;= \begin{cases}
\frac{1+a}{4} - \frac{a}{1-a}\,f_0 &amp; n=0
\\
 \frac{1-a^3}{2\,(1-a)} - \frac{a}{1-a}\,f_1 &amp;n=1
\\
\frac{2\,n+1}{2\,(n-1)\,(1-a)}\,\left[ \left(a^2-\frac{1}{n+2}\right)\,P_n(a) -  \frac{n+1}{n+2}\,a\,P_{n+1}(a)\,\right] - \frac{a}{1-a}\,f_n &amp; n\geq 2
\end{cases}
\\
&amp;= \begin{cases}
\frac{1-a}{4} &amp; n=0
\\
 \frac{(1-a)\,(2+a)}{4}  &amp;n=1
\\
\frac{2\,n+1}{2\,n\,(n-1)\,(2+n)\,(1-a)}\,\left[ \left(a^2\,(2+n)-1\right)\,P_n(a) -  2\,a\,P_{n+1}(a)\,\right] &amp; n\geq 2
\end{cases}
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(f_n\)</span> are still the Legendre coefficients of the spherical cap function, eq. <a class="reference internal" href="#equation-p-20">(4.20)</a>.</p>
<p>Similar to what already done for the spherical cap function, we first calculate the Legendre coefficients of the spherical shield function</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>          <span class="c1"># Legendre coefficients of the shield function</span>

<span class="n">hn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
<span class="n">hn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> 
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">hn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">Pn</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 

<span class="c1"># Figure</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">hn</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hn</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Legendre coefficients  $h_n$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Degree  $n$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/3bbf7a9fec6985430792975c33cf73a5868661be5ea8b2ce7f09d72edaaba8ad.png" src="../_images/3bbf7a9fec6985430792975c33cf73a5868661be5ea8b2ce7f09d72edaaba8ad.png" />
</div>
</div>
<div class="full-width docutils">
<p>and then we compare the spherical shield function with its representation in terms of the Legendre polynomials</p>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">function</span> <span class="o">=</span> <span class="p">(</span><span class="n">zs</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>
<span class="n">function</span><span class="p">[</span><span class="n">zs</span><span class="o">&lt;</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">truncated_function</span> <span class="o">=</span> <span class="n">Pns</span> <span class="o">@</span> <span class="n">hn</span>
<span class="n">truncated_function_100</span> <span class="o">=</span> <span class="n">Pns</span><span class="p">[:,:</span><span class="mi">100</span><span class="p">]</span> <span class="o">@</span> <span class="n">hn</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">truncated_function</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;truncated N=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">truncated_function_100</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;truncated N=100&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Spherical cap function&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Colatitues $\gamma$ [deg]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a4d6dc0efafe03da92418d693f36f5476c0672490d98d7610278dc9c969e3e5d.png" src="../_images/a4d6dc0efafe03da92418d693f36f5476c0672490d98d7610278dc9c969e3e5d.png" />
</div>
</div>
</section>
</section>
<section id="real-spherical-harmonics">
<h2><a class="toc-backref" href="#id5"><span class="section-number">4.2. </span>Real spherical harmonics</a><a class="headerlink" href="#real-spherical-harmonics" title="Permalink to this headline">#</a></h2>
<div class="full-width docutils">
<p>The spherical harmonics <span class="math notranslate nohighlight">\(Y_n^m\)</span> are eigenfunctions of the Laplace operator</p>
<div class="math notranslate nohighlight" id="equation-p-27">
<span class="eqno">(4.28)<a class="headerlink" href="#equation-p-27" title="Permalink to this equation">#</a></span>\[
\nabla^2 Y_n^m(\vartheta,\varphi) = - \frac{n\,(n+1)}{r^2}\,Y_n^m(\vartheta,\varphi)
\]</div>
<p>and they can be defined as follows</p>
<div class="math notranslate nohighlight" id="equation-p-28">
<span class="eqno">(4.29)<a class="headerlink" href="#equation-p-28" title="Permalink to this equation">#</a></span>\[
\begin{align}
Y_{n}^{m} = 
\bar{P}_n^{|m|}(\cos\theta)\,\mathrm{tri}_m(\varphi)
\end{align}
\]</div>
<p>where <span class="math notranslate nohighlight">\(n=0,\cdots,\infty\)</span> and <span class="math notranslate nohighlight">\(m=-n,\cdots,n\)</span> are the degree and order of the spherical harmonic and <span class="math notranslate nohighlight">\(\mathrm{tri}_m\)</span> is the following trigognometric function</p>
<div class="math notranslate nohighlight" id="equation-p-29">
<span class="eqno">(4.30)<a class="headerlink" href="#equation-p-29" title="Permalink to this equation">#</a></span>\[\begin{split}
\mathrm{tri}_{m}(\varphi) = \begin{cases} \sin(m\,\varphi) &amp; m &gt; 0 \\
\cos(m\,\varphi) &amp; m\leq  0
\end{cases}
\end{split}\]</div>
<p>Also, <span class="math notranslate nohighlight">\(\hat{P}_n^m\)</span> are the associated Legendre polynomials</p>
<div class="math notranslate nohighlight" id="equation-p-30">
<span class="eqno">(4.31)<a class="headerlink" href="#equation-p-30" title="Permalink to this equation">#</a></span>\[
\bar{P}_n^{m}(z) = N_{n}^{m}\,P_{n}^{m}(z)  \qquad m\geq 0
\]</div>
<p>which corresponds to the associate Legendre polynomial <span class="math notranslate nohighlight">\(P_n^m\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-31">
<span class="eqno">(4.32)<a class="headerlink" href="#equation-p-31" title="Permalink to this equation">#</a></span>\[
P_{n}^{m}(z) = (1-z^2)^{\frac{m}{2}}\,\frac{\md^m P_n(z)}{\md z^m} \qquad m\geq 0
\]</div>
<p>but for a normalization factor</p>
<div class="math notranslate nohighlight" id="equation-p-32">
<span class="eqno">(4.33)<a class="headerlink" href="#equation-p-32" title="Permalink to this equation">#</a></span>\[
N_{n}^m = \sqrt{(2-\delta_{m,0})\,(2\,n+1)\,\frac{(n-m)!}{(n+m)!}}
\]</div>
<p>The normalization constant has been chosen in such a way that</p>
<div class="math notranslate nohighlight" id="equation-p-33a">
<span class="eqno">(4.34)<a class="headerlink" href="#equation-p-33a" title="Permalink to this equation">#</a></span>\[
\int_{-1}^1 \bar{P}_n^m(z)^2\,\md z = 2\,(2-\delta_{m,0})
\]</div>
<p>and, so, it is straightforward to show that the spherical harmonics are orthogonal functions normalized to <span class="math notranslate nohighlight">\(4\,\pi\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-33">
<span class="eqno">(4.35)<a class="headerlink" href="#equation-p-33" title="Permalink to this equation">#</a></span>\[
\int_\Omega Y_n^m(\vartheta,\varphi)\,Y_p^q(\vartheta,\varphi)\,\md \Omega = 4\,\pi\,\delta_{np}\,\delta_{mq}
\]</div>
<p>Here <span class="math notranslate nohighlight">\(\Omega=[0,\pi]\times[0,2\,\pi]\)</span> denotes the surface of the unit sphere and <span class="math notranslate nohighlight">\(\md \Omega=\sin\vartheta\,\md\vartheta\,\md\varphi\)</span> is the infinitesimal solid angle. The choice of using real (rather than complex) spherical harmonics normalizad to <span class="math notranslate nohighlight">\(4\,\pi\)</span> is the common choice in geodesy.</p>
<p>We note that order-0 spherical harmonics read</p>
<div class="math notranslate nohighlight" id="equation-p-34">
<span class="eqno">(4.36)<a class="headerlink" href="#equation-p-34" title="Permalink to this equation">#</a></span>\[
Y_n^0(\vartheta,\varphi) = \bar{P}_n^0(\cos\vartheta) = \sqrt{2\,n+1}\,P_n(\cos\vartheta)
\]</div>
</div>
<section id="spherical-harmonic-expansion">
<h3><a class="toc-backref" href="#id6"><span class="section-number">4.2.1. </span>Spherical harmonic expansion</a><a class="headerlink" href="#spherical-harmonic-expansion" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Similar to the Legendre polynomials which can be used to expand functions defined on the interval <span class="math notranslate nohighlight">\([-1,1]\)</span>, the spherical harmonics can be used to expand functions defined over the unit sphere</p>
<div class="math notranslate nohighlight" id="equation-p-35">
<span class="eqno">(4.37)<a class="headerlink" href="#equation-p-35" title="Permalink to this equation">#</a></span>\[
f(\vartheta,\varphi) = \sum_{n=0}^\infty\sum_{m=-n}^n f_{n,m}\,Y_n^m(\vartheta,\varphi)
\]</div>
<p>where the spherical harmonic coefficients, making use of eq. <a class="reference internal" href="#equation-p-33">(4.35)</a>, can be obtained as follows</p>
<div class="math notranslate nohighlight" id="equation-p-36">
<span class="eqno">(4.38)<a class="headerlink" href="#equation-p-36" title="Permalink to this equation">#</a></span>\[
f_{n,m} = \frac{1}{4\,\pi}\,\int_\Omega f(\vartheta,\varphi)\,Y_n^m(\vartheta,\varphi)\,\md \Omega
\]</div>
</div>
</section>
<section id="spherical-harmonic-addition-theorem">
<h3><a class="toc-backref" href="#id7"><span class="section-number">4.2.2. </span>Spherical harmonic addition theorem</a><a class="headerlink" href="#spherical-harmonic-addition-theorem" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>It can be shown that the Legendre polynomial of degree <span class="math notranslate nohighlight">\(n\)</span> can be expressed in terms spherical harmonics of the same degree  thanks to the so called spherical harmonic addition theory</p>
<div class="math notranslate nohighlight" id="equation-p-37">
<span class="eqno">(4.39)<a class="headerlink" href="#equation-p-37" title="Permalink to this equation">#</a></span>\[
P_n(\cos\gamma) = \frac{1}{2\,n+1}\,\sum_m Y_n^m(\vartheta,\varphi)\,Y_n^m(\vartheta_0,\varphi_0)
\]</div>
<p>with</p>
<div class="math notranslate nohighlight" id="equation-p-38">
<span class="eqno">(4.40)<a class="headerlink" href="#equation-p-38" title="Permalink to this equation">#</a></span>\[
\cos\gamma = \cos\vartheta\,\cos\vartheta_C + \sin\vartheta\,\sin\vartheta_0\,\cos(\varphi-\varphi_0)
\]</div>
<p>The most common application of this theorem consists in expanding axially symmetric functions in spherical harmonics as shown hereinafter</p>
<div class="math notranslate nohighlight" id="equation-p-39">
<span class="eqno">(4.41)<a class="headerlink" href="#equation-p-39" title="Permalink to this equation">#</a></span>\[
f(\gamma) = \sum_n  f_n\,P_n(\cos\gamma) = \sum_{n}\sum_m\,\frac{\bar{f}_n}{2\,n+1}\,Y_n^m(\vartheta,\varphi)\,Y_n^m(\vartheta_0,\varphi_0) = \sum_{n}\sum_m f_{n,m}\,Y_n^m(\vartheta,\varphi)
\]</div>
<p>where <span class="math notranslate nohighlight">\(f_n^m\)</span> are the spherical harmonic coefficients which can be simply obtained starting from the Legendre coefficients <span class="math notranslate nohighlight">\(f_n\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-40">
<span class="eqno">(4.42)<a class="headerlink" href="#equation-p-40" title="Permalink to this equation">#</a></span>\[
f_{n,m} = \frac{f_n}{2\,n+1}\,Y_n^m(\vartheta_C,\varphi_C)
\]</div>
<p>and <span class="math notranslate nohighlight">\((\vartheta_0,\varphi_0)\)</span> are angular coordinates of the axis of symmetry. In the case in which the axis of symmetry coincides with the north pole, <span class="math notranslate nohighlight">\(\vartheta_0=0\)</span> and <span class="math notranslate nohighlight">\(\gamma=\vartheta\)</span>, we have</p>
<div class="math notranslate nohighlight" id="equation-p-41">
<span class="eqno">(4.43)<a class="headerlink" href="#equation-p-41" title="Permalink to this equation">#</a></span>\[
f_{n,m} = \frac{f_n}{2\,n+1}\,Y_n^m(0,\varphi_C) = \frac{f_n}{\sqrt{2\,n+1}}\,\delta_{m0}
\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-p-42">
<span class="eqno">(4.44)<a class="headerlink" href="#equation-p-42" title="Permalink to this equation">#</a></span>\[
f(\vartheta,\varphi) =  \sum_nf_{n,0}\,Y_n^0(\vartheta,\varphi) = \sum_{n=0}^\infty f_n\,P_n(\cos\vartheta)
\]</div>
</div>
</section>
<section id="centrifugal-potential">
<h3><a class="toc-backref" href="#id8"><span class="section-number">4.2.3. </span>Centrifugal potential</a><a class="headerlink" href="#centrifugal-potential" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Let us consider the centrifugal potential</p>
<div class="math notranslate nohighlight" id="equation-p-43">
<span class="eqno">(4.45)<a class="headerlink" href="#equation-p-43" title="Permalink to this equation">#</a></span>\[
\phi_C(\mathbf{r},t) = \frac{(\boldsymbol{\omega}\cdot\mathbf{r})^2 - r^2\,\omega^2}{2} = \frac{r^2\,\omega^2}{2}\,\big(\cos^2\gamma-1)
\]</div>
<p>where the time dendence is given by the angular velocity <span class="math notranslate nohighlight">\(\boldsymbol{\omega}\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span> is the angle between the observation point <span class="math notranslate nohighlight">\(\mathbf{r}\)</span> and the angular velocity <span class="math notranslate nohighlight">\(\boldsymbol{\omega}\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-44">
<span class="eqno">(4.46)<a class="headerlink" href="#equation-p-44" title="Permalink to this equation">#</a></span>\[
\boldsymbol{\omega} = \omega\,\hat{\mathbf{r}}(\vartheta_0,\varphi_0)
\]</div>
<p>In this respect, <span class="math notranslate nohighlight">\((\vartheta_0,\varphi_0)\)</span> are the angular coordinate of the rotation axis.</p>
<p>By consideirng that</p>
<div class="math notranslate nohighlight" id="equation-p-45">
<span class="eqno">(4.47)<a class="headerlink" href="#equation-p-45" title="Permalink to this equation">#</a></span>\[
P_0(z) = 1 \qquad P_2(z) = \frac{3\,z^2-1}{2}
\]</div>
<p>we can rewrite the centrifugal potential as follows</p>
<div class="math notranslate nohighlight" id="equation-p-46">
<span class="eqno">(4.48)<a class="headerlink" href="#equation-p-46" title="Permalink to this equation">#</a></span>\[
\Phi_C(\mathbf{r},t) = f_0(r)\,P_0(\cos\gamma)+f_2(r)\,P_2(\cos\gamma)
\]</div>
<p>where the only non zero Legendre coefficients <span class="math notranslate nohighlight">\(f_0\)</span> and <span class="math notranslate nohighlight">\(f_2\)</span> are given by</p>
<div class="math notranslate nohighlight" id="equation-p-47">
<span class="eqno">(4.49)<a class="headerlink" href="#equation-p-47" title="Permalink to this equation">#</a></span>\[
f_2(r) = - f_0(r) = \frac{\omega^2\,r^2}{3}
\]</div>
<p>Then, thanks to the spherical harmonic addition theorem, we can also obtain the spherical harmonic coefficients</p>
<div class="math notranslate nohighlight" id="equation-p-48">
<span class="eqno">(4.50)<a class="headerlink" href="#equation-p-48" title="Permalink to this equation">#</a></span>\[
\phi_C(\mathbf{r},t) = \phi^C_{0,0}(r)\,Y_0^0(\vartheta,\varphi) + \sum_m \phi^C_{2,m}(r)\,Y_2^m(\vartheta,\varphi)
\]</div>
<p>with</p>
<div class="math notranslate nohighlight" id="equation-p-49">
<span class="eqno">(4.51)<a class="headerlink" href="#equation-p-49" title="Permalink to this equation">#</a></span>\[
\phi^C_{2,m}(r) = \frac{f_2(r)}{5}\,Y_2^m(\vartheta_0,\varphi_0) = \frac{\omega^2\,r^2}{15}\,Y_2^m(\vartheta_0,\varphi_0)
\]</div>
<div class="math notranslate nohighlight" id="equation-p-50">
<span class="eqno">(4.52)<a class="headerlink" href="#equation-p-50" title="Permalink to this equation">#</a></span>\[
\phi^C_{0,0}(r) = f_0(r) = -\frac{\omega^2\,r^2}{3}
\]</div>
</div>
</section>
<section id="plotting-the-associated-legendre-polynomials">
<h3><a class="toc-backref" href="#id9"><span class="section-number">4.2.4. </span>Plotting the associated Legendre polynomials</a><a class="headerlink" href="#plotting-the-associated-legendre-polynomials" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Let us first consider the associated Legendre polynomials. Setting the maximum spherical harmonic degree <span class="math notranslate nohighlight">\(N\)</span>, we have a total of <span class="math notranslate nohighlight">\(P\)</span> associated Legendre polynomials, with <span class="math notranslate nohighlight">\(P\)</span> given by</p>
<div class="math notranslate nohighlight" id="equation-p-51">
<span class="eqno">(4.53)<a class="headerlink" href="#equation-p-51" title="Permalink to this equation">#</a></span>\[
P =\frac{ (N+1)\,(N+2)}{2}
\]</div>
<p>It is usefull to order the associate Legendre polynomial with an index from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(P-1\)</span> increasing with increasing degree <span class="math notranslate nohighlight">\(n\)</span> and order <span class="math notranslate nohighlight">\(m\)</span></p>
<div class="math notranslate nohighlight" id="equation-p-52">
<span class="eqno">(4.54)<a class="headerlink" href="#equation-p-52" title="Permalink to this equation">#</a></span>\[
p = \frac{n\,(n+1)}{2}+ m 
\]</div>
<p>Thanks to the module <code class="docutils literal notranslate"><span class="pre">pyshtools</span></code> we can compute all the associated Legendre polynomial up to degree <span class="math notranslate nohighlight">\(N\)</span> for a given argument <span class="math notranslate nohighlight">\(z=\cos\vartheta\)</span>. Defining a grid over the latitues, from the south to the north poles, we can compute the associated Legendre polynomials as follows</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyshtools.legendre</span> <span class="kn">import</span> <span class="n">PlmBar</span> <span class="k">as</span> <span class="n">PnmBar</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

<span class="n">Nlat</span> <span class="o">=</span> <span class="mi">181</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="n">Nlat</span><span class="p">)</span>
<span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lats</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span>  <span class="c1">#it corresponds to the cosine of the colatitude</span>

<span class="n">Pnms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Nlat</span><span class="p">,</span><span class="n">P</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zs</span><span class="p">):</span>
    <span class="n">Pnms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PnmBar</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="full-width docutils">
<p>and plot them</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nrow</span> <span class="o">=</span> <span class="n">P</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">P</span><span class="o">%</span><span class="k">2</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">nrow</span><span class="p">),</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\hat</span><span class="si">{P}</span><span class="s2">_{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;}^{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;}(\cos</span><span class="se">\\</span><span class="s2">vartheta)$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="n">Pnms</span><span class="p">[:,</span><span class="n">p</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
        
<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Latitude [deg]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="k">2</span>)].set_xlabel(&quot;Latitude [deg]&quot;)

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="n">P</span><span class="p">:]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/2a4c7f6c59a7d3931fca90137ecf2ce961148a2e16aaa1b2aa30cc954aa51c2e.png" src="../_images/2a4c7f6c59a7d3931fca90137ecf2ce961148a2e16aaa1b2aa30cc954aa51c2e.png" />
</div>
</div>
</section>
<section id="plotting-the-spherical-harmonics">
<h3><a class="toc-backref" href="#id10"><span class="section-number">4.2.5. </span>Plotting the spherical harmonics</a><a class="headerlink" href="#plotting-the-spherical-harmonics" title="Permalink to this headline">#</a></h3>
<div class="full-width docutils">
<p>Starting from the sampling of the normalized associated Legendre polynomial over the colatitues, let us now calculate the spherical harmonics including the dependence on the longitudes</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nlon</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Nlat</span><span class="o">-</span><span class="mi">1</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="n">Nlon</span><span class="p">)</span>
<span class="n">Ynms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Nlat</span><span class="p">,</span><span class="n">Nlon</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m</span>
        <span class="n">Ynms</span><span class="p">[:,:,</span><span class="n">p</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">Pnms</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">lons</span><span class="o">*</span><span class="n">dtr</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">Ynms</span><span class="p">[:,:,</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">Pnms</span><span class="p">[:,</span><span class="n">p</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">lons</span><span class="o">*</span><span class="n">dtr</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="full-width docutils">
<p>and plot them</p>
</div>
<div class="cell tag_full-width tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>


<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">P</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">transform</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">Ynm</span> <span class="o">=</span> <span class="n">Ynms</span><span class="p">[:,:,</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="k">continue</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
            
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">Ynm</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;rainbow&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">Ynm</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Degree n = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="o">-</span> <span class="n">m</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Y_{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;}^{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;}(\cos</span><span class="se">\\</span><span class="s2">vartheta)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/a7768e0f96cf4123e1b3035fb8c67626e38a1481e0b61977f97ef444946cb7ec.png" src="../_images/a7768e0f96cf4123e1b3035fb8c67626e38a1481e0b61977f97ef444946cb7ec.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./files"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="L1_Laplace.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>The Laplace transform</p>
      </div>
    </a>
    <a class="right-next"
       href="L0_Harmonic_Vectors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Spherical harmonic vectors</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legendre-polynomials">4.1. Legendre polynomials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-the-legendre-polynomials">4.1.1. Implementation of the Legendre polynomials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-caps">4.1.2. Spherical caps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-realistic-shape-for-an-ice-shield">4.1.3. A more realistic shape for an ice shield</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-spherical-harmonics">4.2. Real spherical harmonics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-expansion">4.2.1. Spherical harmonic expansion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-addition-theorem">4.2.2. Spherical harmonic addition theorem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#centrifugal-potential">4.2.3. Centrifugal potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-associated-legendre-polynomials">4.2.4. Plotting the associated Legendre polynomials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-spherical-harmonics">4.2.5. Plotting the spherical harmonics</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <a href="https://sites.unimi.it/gcambiotti/">Gabriele Cambiotti</a>
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>